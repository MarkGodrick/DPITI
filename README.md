## Image2Text2Image DP: Differential Privacy Data Synthesis Cross Modality
We believe that the text modality can introduce greater variation in image generation under DP constraints while not significantly compromising the quality of the generated data. I personally name our proposed method as **Image2Text2Image DP**, or **DPITI** for short.

### 💡 Proposed Methodology
Following the work [Lin et al.(2024)](https://openreview.net/forum?id=YEhQs8POIo),[Xie et al.(2024)](https://arxiv.org/abs/2403.01749), we aim to exploit more potential from LLM and diffusion models, thus we proposed the following method to enhance the variety of synthesized data while preserving accuracy.

<img src="docs/images0.png" width="300">

### Environment
```bash
# Please prepare torch, transformers and diffusers yourself
conda create -n textdp python=3.12
conda activate textdp

conda install transformers diffusers datasets
# installing PE...
conda install -y -c pytorch -c nvidia faiss-gpu=1.8.0
pip install "private-evolution @ git+https://github.com/microsoft/DPSDA.git"
pip install "private-evolution[image,text] @ git+https://github.com/microsoft/DPSDA.git"
pip install einops
# Others...
```

### Experiment Setup
* **Dataset** : We use **LSUN dataset, bedroom class, train split** as our dataset.
* **Caption** : We're currently using `Salesforce/blip-image-captioning-large` as our caption llm
* **PE** : We use code from [DPSDA](https://github.com/microsoft/DPSDA) and follow its [example](https://github.com/microsoft/DPSDA/blob/main/example/text/pubmed_huggingface/main.py) to run Private Evolution
* **Diffusion** : We're currently using `stabilityai/stable-diffusion-xl-base-1.0`
* **Metrics & Benchmarks** : We're currently using FID and IS to evaluate the quality of synthetic data, and will use synthetic data for down-stream tasks.

### Experiment Results
We post some of our experiment results in the following tables, while example results can be seen in `docs/examples` directory.

<!DOCTYPE html>
<html lang="en">
<body>
<table>
    <tr>
        <td rowspan="2" colspan="3" align="center">PE</td>    
        <td colspan="1" align="center">OpenAI</td> 
        <td colspan="1" align="center">Ali</td> 
    </tr>
    <tr>
        <td align="center">gpt-4o-mini</td> 
        <td align="center">qwen-vl-max</td> 
    </tr>
    <tr>
        <td colspan="3" align="center">Original Caption</td>
        <td align="center">13.5</td>
        <td align="center">12.3</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">Huggingface</td>
        <td rowspan="2" align="center">meta-llama/Meta-Llama-3-8B-Instruct</td>
        <td align="center">noise_multiplier=0.0</td>
        <td align="center">29.9</td>
        <td align="center">28.2</td>
    </tr>
    <tr>
        <td align="center">epsilon=1.0</td>
        <td align="center">40.27</td>
        <td align="center">40.3</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">Ali</td>
        <td rowspan="2" align="center">qwen-max</td>
        <td align="center">noise_multiplier=0.0</td>
        <td align="center">34.6</td>
        <td align="center"></td>
    </tr>
    <tr>
        <td align="center">epsilon=1.0</td>
        <td align="center"></td>
        <td align="center"></td>
    <caption>Table 1: SOTA Experiment results using different captioners and PE LLMs. Evaluation is conducted using <b>10,000+ 1024x1024images</b> generated by <b>stabilityai/stable-diffusion-xl-base-1.0</b> and the original <b>LSUN bedroom dataset</b>. Metric is <b>FID</b>
    </caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
    <tr>
        <td colspan="4" align="center"></td>    
        <td colspan="1" align="center">0</td> 
        <td colspan="1" align="center">1</td> 
        <td colspan="1" align="center">2</td> 
        <td colspan="1" align="center">3</td> 
        <td colspan="1" align="center">4</td> 
        <td colspan="1" align="center">5</td> 
        <td colspan="1" align="center">6</td> 
        <td colspan="1" align="center">7</td> 
        <td colspan="1" align="center">8</td> 
        <td colspan="1" align="center">9</td> 
        <td colspan="1" align="center">10</td> 
    </tr>
    <tr>
        <td rowspan="6" align="center">rephrase</td>
        <td rowspan="4" align="center">w/ few shot</td>
        <td rowspan="2" align="center">w/ chat history</td>
        <td align="center">vote</td>
        <td align="center">50.63</td>
        <td align="center">34.90</td>
        <td align="center">32.68</td>
        <td align="center">31.93</td>
        <td align="center">31.02</td>
        <td align="center">30.66</td>
        <td align="center">30.55</td>
        <td align="center">29.95</td>
        <td align="center">30.02</td>
        <td align="center">29.84</td>
        <td align="center">29.50</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">50.93</td>
        <td align="center">43.70</td>
        <td align="center">41.24</td>
        <td align="center">40.42</td>
        <td align="center">39.42</td>
        <td align="center">38.77</td>
        <td align="center">38.36</td>
        <td align="center">38.16</td>
        <td align="center">38.46</td>
        <td align="center">37.50</td>
        <td align="center">37.49</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">50.46</td>
        <td align="center">34.97</td>
        <td align="center">32.72</td>
        <td align="center">31.78</td>
        <td align="center">31.07</td>
        <td align="center">30.67</td>
        <td align="center">30.08</td>
        <td align="center">30.36</td>
        <td align="center">30.11</td>
        <td align="center">30.22</td>
        <td align="center">30.03</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">50.29</td>
        <td align="center">42.99</td>
        <td align="center">40.84</td>
        <td align="center">40.43</td>
        <td align="center">38.89</td>
        <td align="center">39.45</td>
        <td align="center">38.56</td>
        <td align="center">38.81</td>
        <td align="center">38.53</td>
        <td align="center">37.89</td>
        <td align="center">38.03</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/o few shot</td>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">51.42</td>
        <td align="center">34.53</td>
        <td align="center">32.19</td>
        <td align="center">31.16</td>
        <td align="center">30.82</td>
        <td align="center">30.14</td>
        <td align="center">30.26</td>
        <td align="center">30.17</td>
        <td align="center">29.85</td>
        <td align="center">29.90</td>
        <td align="center">29.68</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">51.20</td>
        <td align="center">42.23</td>
        <td align="center">40.43</td>
        <td align="center">39.19</td>
        <td align="center">39.16</td>
        <td align="center">38.30</td>
        <td align="center">37.67</td>
        <td align="center">38.06</td>
        <td align="center">37.64</td>
        <td align="center">37.57</td>
        <td align="center">37.33</td>
    </tr>
    <tr>
        <td rowspan="6" align="center">fill in the blanks</td>
        <td rowspan="4" align="center">w/ few shot</td>
        <td rowspan="2" align="center">w/ chat history</td>
        <td align="center">vote</td>
        <td align="center">50.71</td>
        <td align="center">33.72</td>
        <td align="center">30.43</td>
        <td align="center">29.06</td>
        <td align="center">28.32</td>
        <td align="center">28.08</td>
        <td align="center">27.20</td>
        <td align="center">26.92</td>
        <td align="center">26.88</td>
        <td align="center">26.88</td>
        <td align="center"><b>26.52</b></td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">46.74</td>
        <td align="center">41.31</td>
        <td align="center">39.19</td>
        <td align="center">37.43</td>
        <td align="center">37.15</td>
        <td align="center">37.38</td>
        <td align="center">35.14</td>
        <td align="center">35.58</td>
        <td align="center">34.72</td>
        <td align="center">34.95</td>
        <td align="center">33.55</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">51.28</td>
        <td align="center">34.08</td>
        <td align="center">32.10</td>
        <td align="center">31.07</td>
        <td align="center">30.12</td>
        <td align="center">29.53</td>
        <td align="center">29.32</td>
        <td align="center">28.90</td>
        <td align="center">28.48</td>
        <td align="center">28.07</td>
        <td align="center">28.05</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">46.73</td>
        <td align="center">43.26</td>
        <td align="center">42.49</td>
        <td align="center">41.64</td>
        <td align="center">41.82</td>
        <td align="center">41.73</td>
        <td align="center">42.82</td>
        <td align="center">42.18</td>
        <td align="center">41.10</td>
        <td align="center">40.79</td>
        <td align="center">41.90</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/o few shot</td>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">50.84</td>
        <td align="center">33.74</td>
        <td align="center">31.49</td>
        <td align="center">29.87</td>
        <td align="center">29.32</td>
        <td align="center">28.49</td>
        <td align="center">28.14</td>
        <td align="center">27.82</td>
        <td align="center">27.62</td>
        <td align="center">27.69</td>
        <td align="center">27.79</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">45.73</td>
        <td align="center">42.21</td>
        <td align="center">41.39</td>
        <td align="center">40.88</td>
        <td align="center">40.85</td>
        <td align="center">40.52</td>
        <td align="center">40.03</td>
        <td align="center">40.68</td>
        <td align="center">40.69</td>
        <td align="center">39.57</td>
        <td align="center">39.09</td>
    </tr>
    <caption>Table 2: Experiment results on different checkpoints of the same settings.
    <b>Captioner: gpt-4o-mini</b>,
    <b>PE LLM: Meta-Llama-3-8B-Instruct</b>,
    <b>noise_multiplier=0</b>
    </caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
    <tr>
        <td colspan="4" align="center"></td>    
        <td colspan="1" align="center">0</td> 
        <td colspan="1" align="center">1</td> 
        <td colspan="1" align="center">2</td> 
        <td colspan="1" align="center">3</td> 
        <td colspan="1" align="center">4</td> 
        <td colspan="1" align="center">5</td> 
        <td colspan="1" align="center">6</td> 
        <td colspan="1" align="center">7</td> 
        <td colspan="1" align="center">8</td> 
        <td colspan="1" align="center">9</td> 
        <td colspan="1" align="center">10</td> 
    </tr>
    <tr>
        <td rowspan="4" align="center">fill-in-the-blanks</td>
        <td rowspan="2" align="center">w/ few shot</td>
        <td rowspan="2" align="center">w/ chat history</td>
        <td align="center">vote</td>
        <td align="center">50.62</td>
        <td align="center">33.89</td>
        <td align="center">30.09</td>
        <td align="center">29.16</td>
        <td align="center">28.21</td>
        <td align="center">27.78</td>
        <td align="center">27.16</td>
        <td align="center">27.07</td>
        <td align="center">26.86</td>
        <td align="center"><b>26.57</b></td>
        <td align="center">26.68</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">45.49</td>
        <td align="center">40.88</td>
        <td align="center">38.66</td>
        <td align="center">37.16</td>
        <td align="center">36.24</td>
        <td align="center">36.00</td>
        <td align="center">34.77</td>
        <td align="center">34.59</td>
        <td align="center">33.97</td>
        <td align="center">33.30</td>
        <td align="center">33.46</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/o few shot</td>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">50.54</td>
        <td align="center">34.10</td>
        <td align="center">31.37</td>
        <td align="center">30.11</td>
        <td align="center">29.33</td>
        <td align="center">28.78</td>
        <td align="center">28.23</td>
        <td align="center">28.24</td>
        <td align="center">27.86</td>
        <td align="center">27.58</td>
        <td align="center">27.24</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">45.91</td>
        <td align="center">41.37</td>
        <td align="center">40.91</td>
        <td align="center">39.82</td>
        <td align="center">39.52</td>
        <td align="center">39.27</td>
        <td align="center">39.09</td>
        <td align="center">38.11</td>
        <td align="center">38.30</td>
        <td align="center">38.35</td>
        <td align="center">37.48</td>
    </tr>
    <tr>
        <td rowspan="2" align="center">rephrase</td>
        <td rowspan="2" align="center">w/o few shot</td>
        <td rowspan="2" align="center">w/o chat history</td>
        <td align="center">vote</td>
        <td align="center">50.30</td>
        <td align="center">33.10</td>
        <td align="center">30.26</td>
        <td align="center">29.07</td>
        <td align="center">28.57</td>
        <td align="center">27.96</td>
        <td align="center">27.96</td>
        <td align="center">27.79</td>
        <td align="center">27.74</td>
        <td align="center">27.73</td>
        <td align="center">27.49</td>
    </tr>
    <tr>
        <td align="center">variation</td>
        <td align="center">43.79</td>
        <td align="center">40.08</td>
        <td align="center">38.73</td>
        <td align="center">36.70</td>
        <td align="center">36.05</td>
        <td align="center">34.74</td>
        <td align="center">35.46</td>
        <td align="center">34.09</td>
        <td align="center">34.82</td>
        <td align="center">33.95</td>
        <td align="center">33.40</td>
    </tr>
    <caption>Table 3: Experiment results on different checkpoints of the same settings.
    <b>Captioner: gpt-4o-mini</b>,
    <b>PE LLM: Meta-Llama-3-8B-Instruct</b>,
    <b>epsilon=1.0</b>,
    with <b>300,000</b> samples from lsun bedroom
    </caption>
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
    <tr>
        <td colspan="3" align="center"></td>
        <td align="center">original</td>
        <td align="center">step=1</td>
        <td align="center">step=2</td>
        <td align="center">step=4</td>
        <td align="center">step=8</td>
    </tr>
    <tr>
        <td colspan="3" align="center">original caption</td>
        <td align="center">13.57</td>
        <td align="center"></td>
        <td align="center">24.50</td>
        <td align="center">19.90</td>
        <td align="center">19.56</td>
    </tr>
    <tr>
        <td rowspan="4" align="center">w/o filter</td>
        <td rowspan="2" align="center">w/o few-shot</td>
        <td align="center">w/o chat history</td>
        <td align="center">29.94</td>
        <td align="center">50.46</td>
        <td align="center">44.56</td>
        <td align="center">38.08</td>
        <td align="center">33.74</td>
    </tr>
    <tr>
        <td align="center">w/ chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/ few-shot</td>
        <td align="center">w/o chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
    </tr>
    <tr>
        <td align="center">w/ chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
    </tr>
    <tr>
        <td rowspan="4" align="center">w/ filter</td>
        <td rowspan="2" align="center">w/o few-shot</td>
        <td align="center">w/o chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center">42.09</td>
        <td align="center">35.80</td>
        <td align="center">32.94</td>
    </tr>
    <tr>
        <td align="center">w/ chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center"></td>
    </tr>
    <tr>
        <td rowspan="2" align="center">w/ few-shot</td>
        <td align="center">w/o chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center">43.75</td>
        <td align="center">37.17</td>
        <td align="center">33.37</td>
    </tr>
    <tr>
        <td align="center">w/ chat history</td>
        <td align="center"></td>
        <td align="center"></td>
        <td align="center">56.46</td>
        <td align="center">48.21</td>
        <td align="center">42.68</td>
    </tr>
    <caption>Table 4: <b>(FID)</b> Experiment results on different diffusion models with different sample steps.
    </caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
<tr>
    <td colspan="4" align="center"></td>
    <td align="center">step=2</td>
    <td align="center">step=4</td>
    <td align="center">step=8</td>
</tr>
<tr>
    <td colspan="4" align="center">original caption</td>
    <td align="center">28.36</td>
    <td align="center">24.51</td>
    <td align="center">24.11</td>
</tr>
<tr>
    <td rowspan="8" align="center">w/ few-shot</td>
    <td rowspan="4" align="center">text voting</td>
    <td rowspan="2" align="center">w/ chat history</td>
    <td align="center">vote</td>
    <td align="center">61.97</td>
    <td align="center">52.38</td>
    <td align="center">47.44</td>
</tr>
<tr>
    <td align="center">variation</td>
    <td align="center">60.68</td>
    <td align="center">51.62</td>
    <td align="center">45.63</td>
</tr>
<tr>
    <td rowspan="2" align="center">w/o chat history</td>
    <td align="center">vote</td>
    <td align="center">48.57</td>
    <td align="center">41.60</td>
    <td align="center">37.32</td>
</tr>
<tr>
    <td align="center">variation</td>
    <td align="center">46.92</td>
    <td align="center">41.33</td>
    <td align="center">37.59</td>
</tr>
<tr>
    <td rowspan="4" align="center">image voting</td>
    <td rowspan="2" align="center">w/ chat history</td>
    <td align="center">vote</td>
    <td align="center">47.57</td>
    <td align="center">40.88</td>
    <td align="center">37.38</td>
</tr>
<tr>
    <td align="center">variation</td>
    <td align="center">47.89</td>
    <td align="center">40.48</td>
    <td align="center">37.21</td>
</tr>
<tr>
    <td rowspan="2" align="center">w/o chat history</td>
    <td align="center">vote</td>
    <td align="center">46.12</td>
    <td align="center">39.70</td>
    <td align="center">35.79</td>
</tr>
<tr>
    <td align="center">variation</td>
    <td align="center">45.18</td>
    <td align="center">38.95</td>
    <td align="center">34.55</td>
</tr>
<caption>Table 5: <b>(FID)</b> Experiment results on different samples. diffusion:sdxl-turbo
</caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
<tr>
    <td colspan="2" align="center"></td>
    <td align="center">0</td>
    <td align="center">1</td>
    <td align="center">2</td>
    <td align="center">3</td>
    <td align="center">4</td>
    <td align="center">5</td>
    <td align="center">6</td>
    <td align="center">7</td>
    <td align="center">8</td>
    <td align="center">9</td>
    <td align="center">10</td>
    <td align="center">11</td>
    <td align="center">12</td>
    <td align="center">13</td>
    <td align="center">14</td>
    <td align="center">15</td>
    <td align="center">16</td>
    <td align="center">17</td>
    <td align="center">18</td>
    <td align="center">19</td>
    <td align="center">20</td>
</tr>
<tr>
<td rowspan="2" align="center">look_ahead=0</td>
<td align="center">vote</td>
<td align="center">50.62</td>
<td align="center">33.89</td>
<td align="center">30.09</td>
<td align="center">29.17</td>
<td align="center">28.22</td>
<td align="center">27.79</td>
<td align="center">27.16</td>
<td align="center">27.07</td>
<td align="center">26.87</td>
<td align="center">26.58</td>
<td align="center">26.68</td>
<td align="center">26.31</td>
<td align="center">26.43</td>
<td align="center">26.02</td>
<td align="center">26.1</td>
<td align="center">26.46</td>
<td align="center">26.42</td>
<td align="center">26.16</td>
<td align="center"><b>25.82</b></td>
<td align="center">25.91</td>
<td align="center">25.96</td>
</tr>
<tr>
<td align="center">variation</td>
<td align="center">45.5</td>
<td align="center">40.89</td>
<td align="center">38.66</td>
<td align="center">37.16</td>
<td align="center">36.25</td>
<td align="center">36.0</td>
<td align="center">34.77</td>
<td align="center">34.59</td>
<td align="center">33.98</td>
<td align="center">33.31</td>
<td align="center">33.46</td>
<td align="center">33.25</td>
<td align="center">32.68</td>
<td align="center">32.34</td>
<td align="center">32.72</td>
<td align="center">31.6</td>
<td align="center">31.66</td>
<td align="center">31.44</td>
<td align="center">31.46</td>
<td align="center">31.65</td>
<td align="center">30.96</td>
</tr>
<tr>
<td align="center">look_ahead=4</td>
<td align="center">vote</td>
<td align="center">49.77</td>
<td align="center">49.93</td>
<td align="center">45.04</td>
<td align="center">41.44</td>
<td align="center">38.33</td>
<td align="center">36.3</td>
<td align="center">35.31</td>
<td align="center">34.2</td>
<td align="center">33.2</td>
<td align="center">31.66</td>
<td align="center">31.73</td>
<td align="center">30.65</td>
<td align="center">30.73</td>
<td align="center">30.39</td>
<td align="center">30.07</td>
<td align="center">29.42</td>
<td align="center">29.1</td>
<td align="center">28.86</td>
<td align="center">28.54</td>
<td align="center">28.11</td>
<td align="center">27.92</td>
</tr>
<tr>
<td align="center">look_ahead=8</td>
<td align="center">vote</td>
<td align="center">50.25</td>
<td align="center">50.21</td>
<td align="center">45.05</td>
<td align="center">41.44</td>
<td align="center">37.81</td>
<td align="center">36.18</td>
<td align="center">34.24</td>
<td align="center">32.85</td>
<td align="center">32.32</td>
<td align="center">31.37</td>
<td align="center">30.76</td>
<td align="center">29.85</td>
<td align="center">29.14</td>
<td align="center">28.9</td>
<td align="center">28.46</td>
<td align="center">28.35</td>
<td align="center">28.2</td>
<td align="center">27.73</td>
<td align="center">27.06</td>
<td align="center">27.4</td>
<td align="center">27.26</td>
</tr>
<caption>Table 6: <b>(FID)</b> Image-to-text-to-image PE results with different look-ahead degrees.
</caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
<tr>
    <td colspan="2" align="center"></td>
    <td align="center">0</td>
    <td align="center">1</td>
    <td align="center">2</td>
    <td align="center">3</td>
    <td align="center">4</td>
    <td align="center">5</td>
    <td align="center">6</td>
    <td align="center">7</td>
</tr>
<tr>
<td align="center">look_ahead=4</td>
<td align="center">vote</td>
<td align="center">55.74</td>
<td align="center">48.92</td>
<td align="center">47.48</td>
<td align="center">46.51</td>
<td align="center">44.72</td>
<td align="center">40.23</td>
<td align="center">39.23</td>
<td align="center">39.49</td>
</tr>
<tr>
<td align="center">look_ahead=8</td>
<td align="center">vote</td>
<td align="center">56.71</td>
<td align="center">48.19</td>
<td align="center">44.57</td>
<td align="center">43.83</td>
<td align="center">43.88</td>
<td align="center">39.79</td>
<td align="center">38.74</td>
<td align="center">38.76</td>
</tr>
<caption>Table 7: <b>(FID)</b> Original image PE results with different look-ahead degrees.
</caption> 
</table>
</body>
</html>

---

<!DOCTYPE html>
<html lang="en">
<body>
<table>
<tr>
    <td colspan="2" align="center"></td>
    <td align="center">0</td>
    <td align="center">1</td>
    <td align="center">2</td>
    <td align="center">3</td>
    <td align="center">4</td>
    <td align="center">5</td>
    <td align="center">6</td>
    <td align="center">7</td>
    <td align="center">8</td>
    <td align="center">9</td>
    <td align="center">10</td>
    <td align="center">11</td>
    <td align="center">12</td>
    <td align="center">13</td>
    <td align="center">14</td>
    <td align="center">15</td>
    <td align="center">16</td>
    <td align="center">17</td>
</tr>
<tr>
<td colspan="2" align="center">Original PE Image</td>
<td align="center">107.4</td>
<td align="center">85.91</td>
<td align="center">74.45</td>
<td align="center">77.13</td>
<td align="center">76.22</td>
<td align="center">74.23</td>
<td align="center">73.12</td>
<td align="center">67.96</td>
<td align="center">68.23</td>
<td align="center">53.26</td>
<td align="center">53.09</td>
<td align="center">54.35</td>
<td align="center">55.05</td>
<td align="center">54.48</td>
<td align="center">56.27</td>
<td align="center">53.72</td>
<td align="center">52.22</td>
<td align="center">52.33</td>
</tr>
<tr>
<td align="center">epsilon=7.89</td>
<td align="center">variation</td>
<td align="center">113.0</td>
<td align="center">116.6</td>
<td align="center">119.1</td>
<td align="center">118.6</td>
<td align="center">113.8</td>
<td align="center">122.6</td>
<td align="center">118.6</td>
<td align="center">125.5</td>
<td align="center">120.0</td>
<td align="center">119.0</td>
<td align="center">121.5</td>
<td align="center">122.3</td>
<td align="center">113.2</td>
<td align="center">116.6</td>
<td align="center">117.2</td>
<td align="center">120.8</td>
<td align="center">120.9</td>
<td align="center">114.5</td>
</tr>
<tr>
<td rowspan="2" align="center">noise_multiplier=0</td>
<td align="center">variation</td>
<td align="center">116.2</td>
<td align="center">115.0</td>
<td align="center">116.2</td>
<td align="center">113.0</td>
<td align="center">113.7</td>
<td align="center">106.4</td>
<td align="center">114.3</td>
<td align="center">114.0</td>
<td align="center">117.4</td>
<td align="center">112.8</td>
<td align="center">109.8</td>
<td align="center">113.5</td>
<td align="center">111.1</td>
<td align="center">111.2</td>
<td align="center">113.3</td>
<td align="center">115.3</td>
<td align="center">111.8</td>
<td align="center">104.3</td>
</tr>
<caption>Table 8: <b>(FID)</b> Image-to-Text-to-Image on Cat dataset
</caption> 
</table>
</body>
</html>

### To-Do
* Test on various benchmarks
    * FID: Cat dataset / ...
        * generate the original dataset and evaluate FID score
    * Downstream: Medical/... dataset
        * generate a new dataset, and train the downstream model with the following strategies:
            * Original dataset only
            * Generated dataset only
            * Original and Generated mixed
        * check model's accuracy or whatever
        * possible datasets: Camelyon17, CT, Headscan
* Compare with baseline
    * DPSGD diffusion model

<html>
<body>
<table>
<tr>
<td>Dataset</td>
<td>sample num</td>
<td>resolution</td>
<td>classes</td>
<td>url</td>
<td>notes</td>
</tr>
<tr>
<td>LeX-10K</td>
<td>10,000</td>
<td>1024x1024</td>
<td>None</td>
<td>https://huggingface.co/datasets/X-ART/LeX-10K</td>
<td>Generated Images</td>
</tr>
<tr>
<td>european art</td>
<td>15,154</td>
<td>most>512x512</td>
<td>European Artworks</td>
<td>https://huggingface.co/datasets/biglam/european_art</td>
<td>None</td>
</tr>
<caption>Selected Dataset
</caption> 
</table>
</body>
</html>


#### Done
* ✅ Add a logger.
* ✅ Currently we caption images with normal length.
   * Enable Dense Caption in `caption/script.py`. 
   * use OpenAI API key (gpt-4o) or 千问 API keys to generate dense caption.
* ✅ We find running PE decline text quality heavily.
    * Three ways to improve quality:
        * Improve Prompt
        * Change hyperparameters: iterations, temperature
        * Use splits that has higher quality
    * Try using fill-in-the-blanks for the model
    * change prompt for models
        * prompt with word "short" in the model
        * prompt model to remove header
        * prompt model to give a fine tail
        * prompt that the model is going to generate prompt for stable diffusion model
        * few-shot demonstration
* Currently we do sampling using a `diffusers` pipeline.
    * find a way to increase `max_token_num` for diffusion models.`
    * Use more agents to do image sampling. Read more papers to see if this strategy greatly improves the quality.
    * DALL-E / Stable-Diffusion
* ✅ We need to find a standard evaluation method
    * we should resize to 256 first to call fid code
    * use LSUN preprocess repo
* ✅ Compute fid on different checkpoints.
* ✅ Use caption to generate image samples directly -> serve as upper bound.
    * use OpenAI API caption